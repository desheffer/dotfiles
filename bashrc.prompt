# Note: Colors can be approximated with the following equation:
#       6^2 * $R + 6 * $G + $B + 16
#       Where $R, $G, and $B are in the range (0, 5).

icon_left_sep=''
icon_left_sep_alt=''
icon_right_sep=''
icon_right_sep_alt=''

function color_reset {
    echo -en "\033[0m"
}

function block_start {
    color_reset
    tput setaf "$1"
    tput setab "$2"

    block_current_fg="$1"
    block_current_bg="$2"
}

function block_change {
    color_reset
    tput setaf "$block_current_bg"
    tput setab "$2"
    echo -en "$icon_left_sep"
    color_reset
    tput setaf "$1"
    tput setab "$2"

    block_current_fg="$1"
    block_current_bg="$2"
}

function block_sep {
    color_reset
    tput setaf "$1"
    tput setab "$block_current_bg"
    echo -en "$icon_left_sep_alt"
    color_reset
    tput setaf "$block_current_fg"
    tput setab "$block_current_bg"
}

function block_end {
    color_reset
    tput setaf "$block_current_bg"
    echo -en "$icon_left_sep"
    color_reset

    block_current_fg=
    block_current_bg=
}

function block_text {
    echo -en "  $@  "
}

function generate_prompt {
    if [ -z "$PROMPT_COLOR" ]; then
        PROMPT_COLOR=7
    fi

    # Window title.
    echo -en "\033]0;\u@\h:\w\a"

    # Basic prompt.
    echo
    block_start 0 $PROMPT_COLOR
    block_text "\u@\h"
    block_change 15 237
    block_text "\w"
    block_end

    # Git info.
    tput setaf $PROMPT_COLOR
    block_text "$(__git_ps1 %s)"
    color_reset

    echo -en "\n\$ "
}

function set_prompt {
    PS1="$(generate_prompt)"
}

PROMPT_COMMAND='set_prompt'
